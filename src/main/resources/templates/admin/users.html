<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      th:replace="~{layouts/app :: layout('User Access', 'users', 'Admin view of accounts, roles, and brewery affiliations.', ~{::section[@id='page-content']})}">
<section id="page-content">
  <section class="page-section">
    <div class="card-grid">
      <article class="metric-card">
        <header>
          <h3>Total accounts</h3>
          <span class="metric-pill success" th:text="${#lists.size(users)} + ' active'">0 active</span>
        </header>
        <div class="metric-value" th:text="${#lists.size(users)}">0</div>
        <footer class="muted">Accounts with access to Mythic Tales BMS.</footer>
      </article>
      <article class="metric-card">
        <header>
          <h3>Site admins</h3>
          <span class="metric-pill warning">Scoped</span>
        </header>
        <div class="metric-value"
             th:text="${users != null ? users.?[role == 'ROLE_SITE_ADMIN'].size() : 0}">0</div>
        <footer class="muted">Users with global platform privileges.</footer>
      </article>
    </div>
  </section>

  <section class="page-section">
    <div class="section-heading">
      <div>
        <h2>Account directory</h2>
        <p class="muted">Sorted alphabetically by username with linked affiliations.</p>
      </div>
    </div>
    <div class="table-wrapper">
      <table class="table">
        <thead>
          <tr>
            <th>Username</th>
            <th>Role</th>
            <th>Brewery</th>
            <th>Taproom</th>
            <th>Bar</th>
          </tr>
        </thead>
        <tbody>
          <tr th:each="u : ${users}">
            <td class="nowrap" th:text="${u.username}">username</td>
            <td>
              <span th:text="${#strings.replace(u.role,'ROLE_','')}"
                    th:class="${u.role} == 'ROLE_SITE_ADMIN' ? 'badge orange' : 'badge blue'}">ROLE</span>
            </td>
            <td th:text="${u.brewery != null ? u.brewery.name : '-'}">-</td>
            <td th:text="${u.taproom != null ? u.taproom.name : '-'}">-</td>
            <td th:text="${u.bar != null ? u.bar.name : '-'}">-</td>
          </tr>
          <tr th:if="${#lists.isEmpty(users)}">
            <td class="muted" colspan="5">No users found.</td>
          </tr>
        </tbody>
      </table>
    </div>
  </section>
</section>
</html>
